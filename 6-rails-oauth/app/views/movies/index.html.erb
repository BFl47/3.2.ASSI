<p id="notice"><%= notice %></p>

<h1>Movies</h1>

<table>
  <thead>
    <tr>
      <% highlight_title_heading = "hilite" if !params[:sort_order].nil? and 'title' == params[:sort_order] %>
      <th class="<%= highlight_title_heading %>">
        <%= link_to "Title", movies_path(sort_order: :title, ratings: @linkto_ratings) %>
      </th>
      <th>Rating</th>
      <th>Description</th>
      <% highlight_release_date_heading = "hilite" if !params[:sort_order].nil? and 'release_date' == params[:sort_order] %>
      <th class="<%= highlight_release_date_heading %>">
        <%= link_to "Release date", movies_path(sort_order: :release_date, ratings: @linkto_ratings) %>
      </th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @movies.each do |movie| %>
      <tr>
        <td><%= movie.title %></td>
        <td><%= movie.rating %></td>
        <td><%= movie.description %></td>
        <td><%= movie.release_date %></td>
        <td><%= link_to 'Show', movie %></td>
        <td><%= link_to 'Edit', edit_movie_path(movie) %></td>
        <td><%= button_to 'Destroy', movie, method: :delete, data: { confirm: 'Are you sure?' }, class: 'destroy-button' %></td>
      </tr>
    <% end %>

    <%= form_tag movies_path, method: :get, id: 'ratings_form' do %>
      Show (all if none selected): &nbsp;&nbsp;&nbsp;
      <% @all_ratings.each do |rating| %>
        <div class="form-check  form-check-inline">
          <%= check_box_tag "ratings[#{rating}]", "1",  @selected_ratings.include?(rating), class: 'form-check-input' %>
          <%= label_tag "ratings[#{rating}]", rating, class: 'form-check-label' %>
        </div>
      <% end %>
      
      <%= submit_tag 'Refresh', id: 'ratings_submit', class: 'btn btn-primary' %>
      <hr/>
    <% end %>
    

  </tbody>
</table>

<br>

<script>
  document.querySelectorAll('.destroy-button').forEach(button => {
    button.addEventListener('click', (event) => {
      if (!confirm(event.target.dataset.confirm)) {
        event.preventDefault(); // Interrompi l'invio del modulo se l'utente annulla la conferma
      }
    });
  });
</script>

<%= link_to 'New Movie', new_movie_path %>

<%= debug session[:sort_order]%>
<%= debug session[:ratings]%>
<%= debug session[:user_id]%> 
